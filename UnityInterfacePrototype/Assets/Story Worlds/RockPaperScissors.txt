storyworld RockPaperScissors
{
	user: Ann;
	
	entity Ann
	{
		tag: player1;
		string: name, "Ann";
		image: throwRock, annThrowRock;
		image: throwPaper, annThrowPaper;
		image: throwScissors, annThrowScissors;
		image: lost, annLost;
		image: won, annWon;
	}
	
	entity Jack
	{
		tag: player2;
		string: name, "Jack";
		image: throwRock, jackThrowRock;
		image: throwPaper, jackThrowPaper;
		image: throwScissors, jackThrowScissors;
		image: lost, jackLost;
		image: won, jackWon;
	}
	
	entity RPS
	{
		tag: game;
		num: state, 0;
		image: back, back0;
	}
	
	verb ThrowRock
	{
		icon: rockIcon;
		
		case player1
		{
			where: ?me has tag player1;
			where: RPS.state = 0;
			
			do: ?me add tag rock;
			do: RPS.state = 1;
			
			page verb
			{
				draw: RPS.back, 0, 0;
				draw: ?me.throwRock, 0, 0;
				text: "?me.name threw rock."
			}
		}
		
		case player2
		{
			where: ?me has tag player2;
			where: RPS.state = 1;
			
			do: ?me add tag rock;
			do: RPS.state = 2;
			
			page verb
			{
				draw: RPS.back, 0, 0;
				draw: ?me.throwRock, 0, 0;
				text: "?me.name threw rock."
			}
		}
	}
	
	verb ThrowPaper
	{
		icon: paperIcon;
		
		preconditions
		{
			where: RPS.state != 2;
		}
		
		case player1
		{
			where: ?me has tag player1;
			where: RPS.state = 0;
			
			do: ?me add tag paper;
			do: RPS.state = 1;
			
			page verb
			{
				draw: RPS.back, 0, 0;
				draw: ?me.throwPaper, 0, 0;
				text: "?me.name threw paper."
			}
		}
		
		case player2
		{
			where: ?me has tag player2;
			where: RPS.state = 1;
			
			do: ?me add tag paper;
			do: RPS.state = 2;
			
			page verb
			{
				draw: RPS.back, 0, 0;
				draw: ?me.throwPaper, 0, 0;
				text: "?me.name threw paper."
			}
		}
	}
	
	verb ThrowScissors
	{
		icon: scissorsIcon;
		
		preconditions
		{
			where: RPS.state != 2;
		}
		
		case player1
		{
			where: ?me has tag player1;
			where: RPS.state = 0;
			
			do: ?me add tag scissors;
			do: RPS.state = 1;
			
			page verb
			{
				draw: RPS.back, 0, 0;
				draw: ?me.throwScissors, 0, 0;
				text: "?me.name threw scissors."
			}
		}
		
		case player2
		{
			where: ?me has tag player2;
			where: RPS.state = 1;
			
			do: ?me add tag scissors;
			do: RPS.state = 2;
			
			page verb
			{
				draw: RPS.back, 0, 0;
				draw: ?me.throwScissors, 0, 0;
				text: "?me.name threw scissors."
			}
		}
	}
	
	verb AnnounceWinner
	{
		icon: default;
		
		variable ?player1
		{
			where: ?player1 has tag player1;
		}
		
		variable ?player2
		{
			where: ?player2 has tag player2;
		}
		
		preconditions
		{
			where: RPS.state = 2;
		}
		
		case player1WinsWithRock
		{
			where: all ?player1 has tag rock;
			where: all ?player2 has tag scissors;
			
			do: ?player1 remove tag rock;
			do: ?player2 remove tag scissors;
			do: RPS.state = 0;
			
			page verb
			{
				draw: RPS.back, 0, 0;
				draw: ?player1.won, -500, 0;
				draw: ?player2.lost, 500, 0;
				text: "?player1.name won this round!"
			}
		}
				
		case player1WinsWithPaper
		{
			where: all ?player1 has tag paper;
			where: all ?player2 has tag rock;
			
			do: ?player1 remove tag paper;
			do: ?player2 remove tag rock;
			do: RPS.state = 0;
			
			page verb
			{
				draw: RPS.back, 0, 0;
				draw: ?player1.won, -500, 0;
				draw: ?player2.lost, 500, 0;
				text: "?player1.name won this round!"
			}
		}
		
		case player1WinsWithScissors
		{
			where: all ?player1 has tag scissors;
			where: all ?player2 has tag paper;
			
			do: ?player1 remove tag scissors;
			do: ?player2 remove tag paper;
			do: RPS.state = 0;
			
			page verb
			{
				draw: RPS.back, 0, 0;
				draw: ?player1.won, -500, 0;
				draw: ?player2.lost, 500, 0;
				text: "?player1.name won this round!"
			}
		}
		
		case player2WinsWithRock
		{
			where: all ?player2 has tag rock;
			where: all ?player1 has tag scissors;
			
			do: ?player1 remove tag rock;
			do: ?player2 remove tag scissors;
			do: RPS.state = 0;
			
			page verb
			{
				draw: RPS.back, 0, 0;
				draw: ?player1.lost, -500, 0;
				draw: ?player2.won, 500, 0;
				text: "?player2.name won this round!"
			}
		}
				
		case player2WinsWithPaper
		{
			where: all ?player2 has tag paper;
			where: all ?player1 has tag rock;
			
			do: ?player1 remove tag paper;
			do: ?player2 remove tag rock;
			do: RPS.state = 0;
			
			page verb
			{
				draw: RPS.back, 0, 0;
				draw: ?player1.lost, -500, 0;
				draw: ?player2.won, 500, 0;
				text: "?player2.name won this round!"
			}
		}
		
		case player2WinsWithScissors
		{
			where: all ?player2 has tag scissors;
			where: all ?player1 has tag paper;
			
			do: ?player2 remove tag scissors;
			do: ?player1 remove tag paper;
			do: RPS.state = 0;
			
			page verb
			{
				draw: RPS.back, 0, 0;
				draw: ?player1.lost, -500, 0;
				draw: ?player2.won, 500, 0;
				text: "?player2.name won this round!"
			}
		}
		
		case tieWithRock
		{
			where: all ?player1 has tag rock;
			where: all ?player2 has tag rock;
			
			do: ?player1 remove tag rock;
			do: ?player2 remove tag rock;
			do: RPS.state = 0;
		
			page verb
			{
				draw: RPS.back, 0, 0;
				draw: ?player1.lost, -500, 0;
				draw: ?player2.lost, 500, 0;
				text: "It's a tie! Everyone loses this round."
			}		
		}
		
		case tieWithPaper
		{
			where: all ?player1 has tag paper;
			where: all ?player2 has tag paper;
			
			do: ?player1 remove tag paper;
			do: ?player2 remove tag paper;
			do: RPS.state = 0;
		
			page verb
			{
				draw: RPS.back, 0, 0;
				draw: ?player1.lost, -500, 0;
				draw: ?player2.lost, 500, 0;
				text: "It's a tie! Everyone loses this round."
			}		
		}
		
		case tieWithScissors
		{
			where: all ?player1 has tag scissors;
			where: all ?player2 has tag scissors;
			
			do: ?player1 remove tag scissors;
			do: ?player2 remove tag scissors;
			do: RPS.state = 0;
		
			page verb
			{
				draw: RPS.back, 0, 0;
				draw: ?player1.lost, -500, 0;
				draw: ?player2.lost, 500, 0;
				text: "It's a tie! Everyone loses this round."
			}		
		}
	}
}